#!/bin/bash

echo "üîç VERIFYING WHATSAPP SETUP"
echo "============================"
echo ""

# Configuration
PRODUCTION_URL="https://garagemanagerpro.vercel.app"
WHATSAPP_SENDER="+15558340240"
PHONE_NUMBER="+15558340240"

echo "üì± WhatsApp Sender: $WHATSAPP_SENDER"
echo "üåê Production URL: $PRODUCTION_URL"
echo ""

echo "üß™ TESTING WEBHOOK ENDPOINTS:"
echo "=============================="

# Test webhook endpoints
echo "Testing Voice webhook..."
VOICE_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$PRODUCTION_URL/api/twilio/voice")
echo "‚úÖ Voice webhook: HTTP $VOICE_STATUS"

echo "Testing SMS/WhatsApp webhook..."
SMS_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$PRODUCTION_URL/api/webhooks/communication-responses")
echo "‚úÖ SMS/WhatsApp webhook: HTTP $SMS_STATUS"

echo "Testing Status callback..."
STATUS_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$PRODUCTION_URL/api/webhooks/status-callback")
echo "‚úÖ Status callback: HTTP $STATUS_STATUS"

echo ""
echo "üìã CURRENT WEBHOOK CONFIGURATION:"
echo "=================================="
echo "üó£Ô∏è  Voice URL: $PRODUCTION_URL/api/twilio/voice"
echo "üí¨ SMS URL: $PRODUCTION_URL/api/webhooks/communication-responses"
echo "üì± WhatsApp URL: $PRODUCTION_URL/api/webhooks/communication-responses"
echo "üìä Status Callback: $PRODUCTION_URL/api/webhooks/status-callback"
echo ""

echo "üîß TWILIO CONSOLE VERIFICATION:"
echo "==============================="
echo "1. Phone Number Configuration:"
echo "   https://console.twilio.com/us1/develop/phone-numbers/manage/incoming"
echo "   Click on: $PHONE_NUMBER"
echo ""
echo "2. WhatsApp Sandbox Configuration:"
echo "   https://console.twilio.com/us1/develop/sms/whatsapp/sandbox"
echo "   Webhook URL should be: $PRODUCTION_URL/api/webhooks/communication-responses"
echo ""

echo "üì± TEST WHATSAPP MESSAGE:"
echo "========================"
echo "To test WhatsApp functionality:"
echo "1. Join the sandbox by texting 'join <sandbox-code>' to whatsapp:+14155238886"
echo "2. Send a test message to verify webhook reception"
echo "3. Check the application logs for incoming webhook calls"
echo ""

echo "üîç ENVIRONMENT VARIABLES TO CHECK:"
echo "=================================="
echo "Make sure these are set in Vercel:"
echo "‚Ä¢ TWILIO_ACCOUNT_SID"
echo "‚Ä¢ TWILIO_AUTH_TOKEN"
echo "‚Ä¢ TWILIO_PHONE_NUMBER=$WHATSAPP_SENDER"
echo "‚Ä¢ TWILIO_WHATSAPP_NUMBER=whatsapp:$WHATSAPP_SENDER"
echo ""

echo "‚úÖ VERIFICATION COMPLETE!"
echo "üì± WhatsApp Sender Number: $WHATSAPP_SENDER"
echo "üåê All webhooks pointing to: $PRODUCTION_URL"
